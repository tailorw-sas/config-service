# ===============================================
# IDENTITY MICROSERVICE - SPECIFIC CONFIGURATION
# ===============================================

# ===============================================
# SERVER
# ===============================================
server.port=${IDENTITY_SERVER_PORT}

# ===============================================
# DATABASE (Write - JPA/JDBC for DLQ)
# ===============================================
spring.datasource.url=${IDENTITY_DB_HOST_RW}
spring.datasource.username=${IDENTITY_DB_USER_RW}
spring.datasource.password=${IDENTITY_DB_PASSWORD_RW}

# ===============================================
# DATABASE (Read - JPA/JDBC for DLQ)
# ===============================================
spring.read-datasource.url=${IDENTITY_DB_HOST_R}
spring.read-datasource.username=${IDENTITY_DB_USER_R}
spring.read-datasource.password=${IDENTITY_DB_PASSWORD_R}

# ===============================================
# R2DBC WRITE (Reactive)
# ===============================================
spring.r2dbc.driverClassName=org.postgresql.Driver
spring.r2dbc.url=${IDENTITY_DB_HOST_RW_2RDBC}
spring.r2dbc.username=${IDENTITY_DB_USER_RW}
spring.r2dbc.password=${IDENTITY_DB_PASSWORD_RW}
spring.r2dbc.pool.initial-size=10
spring.r2dbc.pool.min-idle=2
spring.r2dbc.pool.max-size=20
spring.r2dbc.pool.max-idle-time=30s
spring.r2dbc.pool.max-life-time=60m
spring.r2dbc.pool.max-acquire-time=15s
spring.r2dbc.pool.maxCreateConnectionTime=60s

# ===============================================
# R2DBC READ (Reactive - Replica)
# ===============================================
spring.read-r2dbc.driverClassName=org.postgresql.Driver
spring.read-r2dbc.url=${IDENTITY_DB_HOST_R_2RDBC}
spring.read-r2dbc.username=${IDENTITY_DB_USER_R}
spring.read-r2dbc.password=${IDENTITY_DB_PASSWORD_R}
spring.read-r2dbc.pool.initial-size=10
spring.read-r2dbc.pool.min-idle=2
spring.read-r2dbc.pool.max-size=20
spring.read-r2dbc.pool.max-idle-time=30s
spring.read-r2dbc.pool.max-life-time=60m
spring.read-r2dbc.pool.max-acquire-time=15s
spring.read-r2dbc.pool.maxCreateConnectionTime=60s

# ===============================================
# FLYWAY (JDBC - Migraciones)
# ===============================================
spring.flyway.enabled=true
spring.flyway.locations=classpath:db/migration
spring.flyway.baseline-on-migrate=true
spring.flyway.validate-on-migrate=true
spring.flyway.out-of-order=false
spring.flyway.clean-disabled=true
spring.flyway.baseline-version=1
spring.flyway.placeholder-replacement=true

spring.flyway.datasource.url=${IDENTITY_DB_HOST_RW}
spring.flyway.datasource.username=${IDENTITY_DB_USER_RW}
spring.flyway.datasource.password=${IDENTITY_DB_PASSWORD_RW}
spring.flyway.datasource.driver-class-name=org.postgresql.Driver
spring.flyway.datasource.hikari.maximum-pool-size=5
spring.flyway.datasource.hikari.minimum-idle=2

spring.flyway.placeholders.admin_user_id=${IDENTITY_USER_SYSTEM_ID}
spring.flyway.placeholders.admin_user_name=${IDENTITY_USER_SYSTEM_USERNAME}

# ===============================================
# JPA/HIBERNATE (for DLQ)
# ===============================================
spring.jpa.hibernate.ddl-auto=none
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.physical_naming_strategy=org.hibernate.boot.model.naming.CamelCaseToUnderscoresNamingStrategy

# ===============================================
# KAFKA
# ===============================================
KAFKA_GROUP_ID=${IDENTITY_KAFKA_GROUP_ID}

finamer.kafka.dlq.enabled=true
finamer.kafka.default-topic=identity-default
finamer.kafka.consumer.group-id=${IDENTITY_KAFKA_GROUP_ID}
finamer.kafka.idempotency.key-prefix=finamer:identity:processed:
finamer.kafka.metrics.prefix=finamer.kafka.identity
finamer.kafka.metrics.default-tags.service=finamer-identity

# ===============================================
# MINIO
# ===============================================
minio.bucketName=${IDENTITY_MINIO_BUCKET_NAME}

# ===============================================
# KEYCLOAK PROVIDER CONFIGURATION
# ===============================================
keycloak.provider.server-url=${KEYCLOAK_BASE_URI}
keycloak.provider.realm-name=${KEYCLOAK_REALM_NAME}
keycloak.provider.realm-master=${KEYCLOAK_REAL_MASTER}
keycloak.provider.admin-clic=${KEYCLOAK_ADMIN_CLI}
keycloak.provider.user-console=${KEYCLOAK_USER_CONSOLE}
keycloak.provider.password-console=${KEYCLOAK_PASSWORD_CONSOLE}
keycloak.provider.client-id=${KEYCLOAK_CLIENT_ID}
keycloak.provider.client-secret=${KEYCLOAK_CLIENT_SECRET}
keycloak.provider.grant_type=${KEYCLOAK_GRANT_TYPE}
keycloak.provider.default-role=${KEYCLOAK_DEFAULT_ROLE}

# ===============================================
# IDENTITY PARAMS CONFIGURATION
# ===============================================
identity.usersystem.id=${IDENTITY_USER_SYSTEM_ID}
identity.usersystem.email=${IDENTITY_USER_SYSTEM_EMAIL}
identity.usersystem.username=${IDENTITY_USER_SYSTEM_USERNAME}
identity.usersystem.name=${IDENTITY_USER_SYSTEM_NAME}
identity.usersystem.lastName=${IDENTITY_USER_SYSTEM_LASTNAME}
identity.business.id=${IDENTITY_BUSINESS_ID}
identity.business.name=${IDENTITY_BUSINESS_NAME}
identity.business.description=${IDENTITY_BUSINESS_DESCRIPTION}
identity.business.logoUrl=${IDENTITY_BUSINESS_LOGO_URL}
identity.business.ruc=${IDENTITY_BUSINESS_RUC}
identity.business.address=${IDENTITY_BUSINESS_ADDRESS}

# ===============================================
# MAIL TEMPLATES
# ===============================================
mail.template.welcome.internal=${IDENTITY_MAIL_TEMPLATE_WELCOME_INTERNAL}
mail.template.welcome.external=${IDENTITY_MAIL_TEMPLATE_WELCOME_EXTERNAL}
mail.template.changePasswordConfirmation.internal=${IDENTITY_MAIL_TEMPLATE_CHANGE_PASSWORD_CONFIRMATION_INTERNAL}
mail.template.changePasswordConfirmation.external=${IDENTITY_MAIL_TEMPLATE_CHANGE_PASSWORD_CONFIRMATION_EXTERNAL}
mail.template.resetPassword.internal=${IDENTITY_MAIL_TEMPLATE_RESET_PASSWORD_INTERNAL}
mail.template.resetPassword.external=${IDENTITY_MAIL_TEMPLATE_RESET_PASSWORD_EXTERNAL}

IDENTITY_MAIL_TEMPLATE_WELCOME_INTERNAL=7443713
IDENTITY_MAIL_TEMPLATE_WELCOME_EXTERNAL=7445740
IDENTITY_MAIL_TEMPLATE_CHANGE_PASSWORD_CONFIRMATION_INTERNAL=7446600
IDENTITY_MAIL_TEMPLATE_CHANGE_PASSWORD_CONFIRMATION_EXTERNAL=7446610
IDENTITY_MAIL_TEMPLATE_RESET_PASSWORD_INTERNAL=7456787
IDENTITY_MAIL_TEMPLATE_RESET_PASSWORD_EXTERNAL=7456780

# ===============================================
# LOGGING (Additional for R2DBC)
# ===============================================
logging.level.org.hibernate.SQL=debug
logging.level.org.hibernate.tool.hbm2ddl=debug
logging.level.org.springframework.r2dbc.core=DEBUG
logging.level.io.r2dbc.spi=DEBUG

# ===============================================
# SECURITY CONFIGURATION
# ===============================================
kynsoft.security.microservice.enabled=false
kynsoft.security.webclient.enabled=true
kynsoft.security.microservice.security.protected-paths=/api/internal/**
